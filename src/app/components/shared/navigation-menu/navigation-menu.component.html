<div class="relative inline-block navigation-dropdown">
  <!-- Dropdown Trigger -->
  <button class="inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 shadow-sm" type="button" (click)="toggleDropdown()">
    <i class="fas fa-bars mr-2"></i>
    Navigation
    <i class="fas fa-chevron-down ml-2 text-xs transition-transform duration-200" [class.rotate-180]="isDropdownOpen"></i>
  </button>

  <!-- Dropdown Menu -->
  <div [ngClass]="{'dropdown-menu': true, 'dropdown-open': isDropdownOpen}" class="absolute right-0 z-50 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 max-h-96 overflow-y-auto">
    <!-- Dashboard as first item -->

    <!-- <div class="p-2">
      <a [routerLink]="getDashboardPath()" routerLinkActive="active" class="flex items-center px-3 py-2 text-sm font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 rounded-md hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors duration-150" (click)="closeDropdown()">
        <i class="fas fa-tachometer-alt mr-3 w-4 text-center"></i>
        Dashboard
      </a>
    </div> -->
    <div class="border-t border-gray-200 dark:border-gray-700"></div>

    <!-- Navigation Menu Section -->

    <!-- <pre>{{hierarchicalMenus | json}}</pre> -->
    <div class="p-2 space-y-1">
      <ng-container *ngFor="let menu of hierarchicalMenus">
        <div *ngIf="!menu.parent_id && menu.name !== 'Dashboard'">
          <ng-container *ngTemplateOutlet="menuTemplate; context: { menu: menu, level: 0 }"></ng-container>
        </div>
      </ng-container>
    </div>

    <!-- Recursive Menu Template -->
    <ng-template #menuTemplate let-menu="menu" let-level="level">
      <ng-container *ngIf="menu.children && menu.children.length > 0; else singleMenu">
        <!-- Parent menu with children -->
        <div class="relative">
          <button [class.parent-active]="menu.is_active" class="w-full flex items-center justify-between px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors duration-150" [style.padding-left.px]="level * 16 + 12" (click)="toggleSubmenu(menu)">
            <div class="flex items-center">
              <i [class]="menu.icon + ' mr-3 w-4 text-center'"></i>
              {{ menu.name }}
            </div>
            <i class="fas fa-chevron-right text-xs transition-transform duration-200" [class.rotate-90]="menu.is_active"></i>
          </button>

          <!-- Submenu -->
          <div [ngClass]="{'submenu': true, 'submenu-open': menu.is_active}" class="mt-1 space-y-1" [style.margin-left.px]="(level + 1) * 16">
            <ng-container *ngFor="let child of menu.children">
              <ng-container *ngTemplateOutlet="menuTemplate; context: { menu: child, level: level + 1 }"></ng-container>
            </ng-container>
          </div>
        </div>
      </ng-container>
      <ng-template #singleMenu>
        <!-- Single menu item -->
        <button *ngIf="menu.path" [class.active]="menu.is_active" (click)="navigateToMenu(menu.path)" class="w-full text-left flex items-center px-3 py-2 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors duration-150" [style.padding-left.px]="level * 16 + 12">
          <i [class]="menu.icon + ' mr-3 w-4 text-center'"></i>
          {{ menu.name }}
        </button>
      </ng-template>
    </ng-template>
  </div>
</div>