<!-- Kitchen Display System Header -->
<!-- <header class="bg-gray-900 text-white p-4 border-b border-gray-700">
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <div>
        <h1 class="text-2xl font-bold">Kitchen Display System</h1>
        <p class="text-gray-300 text-sm">Cafe-X Downtown • Live Orders</p>
      </div>
    </div>
    <div class="flex items-center space-x-4">
      <div class="text-right">
        <div class="text-sm text-gray-300">Current Time</div>
        <div class="text-lg font-mono">{{ currentTime }}</div>
      </div>
      <div class="text-right">
        <div class="text-sm text-gray-300">Active Orders</div>
        <div class="text-2xl font-bold text-green-400">{{ activeOrdersCount }}</div>
      </div>
    </div>
  </div>
</header> -->

<!-- Main KDS Content -->
<main class="flex-1 bg-gray-100 dark:bg-gray-900 p-4 min-h-screen">
  <div class="max-w-full">

    <!-- Order Status Filters -->
    <div class="mb-6 flex flex-wrap gap-2">
      <button
        *ngFor="let status of orderStatuses"
        (click)="setActiveStatus(status.key)"
        [class]="getStatusButtonClass(status.key)">
        <i [class]="status.icon" class="mr-2"></i>
        {{ status.label }}
        <span class="ml-2 px-2 py-0.5 rounded-full text-xs"
              [class]="getStatusCountClass(status.key)">
          {{ getOrdersByStatus(status.key).length }}
        </span>
      </button>
    </div>

    <!-- Orders Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">

      <!-- Order Cards -->
      <div *ngFor="let order of filteredOrders; trackBy: trackByOrderId"
           [class]="getOrderCardClass(order)"
           class="rounded-xl shadow-lg overflow-hidden">

        <!-- Order Header -->
        <div class="p-4 border-b" [class]="getOrderHeaderClass(order)">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center space-x-2">
              <span class="text-lg font-bold">#{{ order.id.split('-').pop() }}</span>
              <span [class]="getPriorityBadgeClass(order)" class="px-2 py-0.5 rounded-full text-xs font-medium">
                {{ getOrderPriority(order) }}
              </span>
            </div>
            <div class="text-right">
              <div class="text-sm opacity-90">{{ order.orderType === 'dine_in' ? 'Table' : 'Takeaway' }}</div>
              <div class="font-semibold">{{ order.tableNumber || 'T/A' }}</div>
            </div>
          </div>

          <div class="flex items-center justify-between text-sm">
            <span>{{ order.customerName }}</span>
            <span class="font-mono">{{ formatTime(order.createdAt) }}</span>
          </div>

          <!-- Order Timer -->
          <div class="mt-2 flex items-center justify-between">
            <div class="flex items-center space-x-2">
              <i class="fas fa-clock text-white/70"></i>
              <span class="font-mono text-sm">{{ getElapsedTime(order.createdAt) }}</span>
            </div>
            <div *ngIf="order.estimatedReadyTime" class="text-xs">
              Est: {{ formatTime(order.estimatedReadyTime) }}
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="p-4 bg-white dark:bg-gray-800">
          <div class="space-y-2 max-h-32 overflow-y-auto">
            <div *ngFor="let item of order.items"
                 class="flex items-center justify-between py-1">
              <div class="flex-1">
                <span class="font-medium text-sm">{{ item.quantity }}x {{ item.menuItemName }}</span>
                <div *ngIf="item.specialInstructions" class="text-xs text-orange-600 dark:text-orange-400 mt-1">
                  <i class="fas fa-exclamation-triangle mr-1"></i>{{ item.specialInstructions }}
                </div>
              </div>
              <span class="text-sm font-medium">₹{{ item.totalPrice }}</span>
            </div>
          </div>

          <!-- Order Total -->
          <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between font-semibold">
              <span>Total: ₹{{ order.totalAmount }}</span>
              <span class="text-xs text-gray-500">{{ order.items.length }} items</span>
            </div>
          </div>
        </div>

        <!-- Order Actions -->
        <div class="p-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
              <button *ngIf="canMoveToNextStatus(order)"
                      (click)="updateOrderStatus(order, getNextStatus(order.status))"
                      class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors text-sm font-medium">
                <i class="fas fa-check mr-1"></i>{{ getNextStatusLabel(order.status) }}
              </button>

              <button *ngIf="order.status === 'ready'"
                      (click)="markOrderServed(order)"
                      class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors text-sm font-medium">
                <i class="fas fa-utensils mr-1"></i>Served
              </button>
            </div>

            <div class="flex items-center space-x-1">
              <button (click)="viewOrderDetails(order)"
                      class="p-2 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
                      title="View Details">
                <i class="fas fa-eye"></i>
              </button>

              <button (click)="printOrder(order)"
                      class="p-2 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
                      title="Print Order">
                <i class="fas fa-print"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredOrders.length === 0"
           class="col-span-full flex items-center justify-center py-16">
        <div class="text-center">
          <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-utensils text-2xl text-gray-400"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No orders in {{ activeStatusLabel }}</h3>
          <p class="text-gray-500 dark:text-gray-400">Orders will appear here when customers place them.</p>
        </div>
      </div>
    </div>

    <!-- Order Details Modal -->
    <div *ngIf="selectedOrder"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold">Order #{{ selectedOrder.id.split('-').pop() }}</h2>
            <button (click)="closeOrderDetails()"
                    class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
              <i class="fas fa-times"></i>
            </button>
          </div>

          <div class="grid grid-cols-2 gap-6 mb-6">
            <div>
              <h3 class="font-semibold mb-2">Customer Details</h3>
              <p><strong>Name:</strong> {{ selectedOrder.customerName }}</p>
              <p><strong>Table:</strong> {{ selectedOrder.tableNumber || 'Takeaway' }}</p>
              <p><strong>Type:</strong> {{ selectedOrder.orderType }}</p>
              <p><strong>Status:</strong> <span [class]="getStatusBadgeClass(selectedOrder.status)">{{ selectedOrder.status }}</span></p>
            </div>

            <div>
              <h3 class="font-semibold mb-2">Order Details</h3>
              <p><strong>Order Time:</strong> {{ formatTime(selectedOrder.createdAt) }}</p>
              <p><strong>Elapsed:</strong> {{ getElapsedTime(selectedOrder.createdAt) }}</p>
              <p *ngIf="selectedOrder.estimatedReadyTime"><strong>Est. Ready:</strong> {{ formatTime(selectedOrder.estimatedReadyTime) }}</p>
              <p><strong>Items:</strong> {{ selectedOrder.items.length }}</p>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="font-semibold mb-3">Order Items</h3>
            <div class="space-y-3">
              <div *ngFor="let item of selectedOrder.items"
                   class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="flex-1">
                  <div class="font-medium">{{ item.quantity }}x {{ item.menuItemName }}</div>
                  <div *ngIf="item.specialInstructions" class="text-sm text-orange-600 dark:text-orange-400 mt-1">
                    Note: {{ item.specialInstructions }}
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-semibold">₹{{ item.totalPrice }}</div>
                  <div class="text-sm text-gray-500">₹{{ item.unitPrice }} each</div>
                </div>
              </div>
            </div>
          </div>

          <div class="border-t pt-4">
            <div class="flex items-center justify-between text-lg font-bold">
              <span>Total Amount:</span>
              <span>₹{{ selectedOrder.totalAmount }}</span>
            </div>
          </div>

          <div class="flex items-center justify-end space-x-3 mt-6">
            <button (click)="printOrder(selectedOrder)"
                    class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">
              <i class="fas fa-print mr-2"></i>Print
            </button>

            <button *ngIf="canMoveToNextStatus(selectedOrder)"
                    (click)="updateOrderStatus(selectedOrder, getNextStatus(selectedOrder.status)); closeOrderDetails()"
                    class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors">
              <i class="fas fa-check mr-2"></i>{{ getNextStatusLabel(selectedOrder.status) }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
