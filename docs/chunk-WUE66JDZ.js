import{a as f}from"./chunk-7C3C72CK.js";import{T as d,Y as u,d as c,k as r,z as a}from"./chunk-QF7ULWVN.js";var m=class n{constructor(t){this.mockDataService=t;this.initializeRealtimeConnection(),this.requestNotificationPermission()}eventSource=null;notificationPermission="default";newOrderSubject=new r(null);newOrder$=this.newOrderSubject.asObservable();orderUpdateSubject=new r(null);orderUpdate$=this.orderUpdateSubject.asObservable();newNotificationSubject=new r(null);newNotification$=this.newNotificationSubject.asObservable();initializeRealtimeConnection(){a(Math.random()*45e3+45e3).subscribe(()=>{this.simulateNewOrder()}),a(Math.random()*3e4+3e4).subscribe(()=>{this.simulateOrderUpdate()}),a(Math.random()*6e4+6e4).subscribe(()=>{this.simulateNewNotification()})}simulateNewOrder(){let t=this.mockDataService;t.addRandomOrder&&(t.addRandomOrder(),this.mockDataService.getOrders().subscribe(e=>{let i=e[e.length-1];i&&new Date(i.createdAt).getTime()>Date.now()-5e3&&(this.newOrderSubject.next(i),this.showBrowserNotification("New Order Received",`Order ${i.id} for ${i.customerName}`,"order"))}))}simulateOrderUpdate(){this.mockDataService.getOrders().subscribe(t=>{let e=t.filter(i=>["pending","confirmed","preparing"].includes(i.status));if(e.length>0){let i=e[Math.floor(Math.random()*e.length)],s={pending:"confirmed",confirmed:"preparing",preparing:"ready"}[i.status];s&&(this.mockDataService.updateOrderStatus(i.id,s),this.orderUpdateSubject.next(i),this.showBrowserNotification("Order Status Updated",`Order ${i.id} is now ${s}`,"order"))}})}simulateNewNotification(){let t=this.mockDataService;t.addRandomNotification&&(t.addRandomNotification(),this.mockDataService.getNotifications().subscribe(e=>{let i=e[e.length-1];i&&new Date(i.timestamp).getTime()>Date.now()-5e3&&(this.newNotificationSubject.next(i),this.showBrowserNotification(i.title,i.message,i.type))}))}requestNotificationPermission(){return c(this,null,function*(){if("Notification"in window&&(this.notificationPermission=Notification.permission,Notification.permission==="default"))try{this.notificationPermission=yield Notification.requestPermission()}catch(t){console.warn("Error requesting notification permission:",t)}})}showBrowserNotification(t,e,i){if(this.notificationPermission==="granted"&&"Notification"in window){let o=new Notification(t,{body:e,icon:"/favicon.ico",badge:"/favicon.ico",tag:`cafe-x-${i}`,requireInteraction:!1,silent:!1});setTimeout(()=>{o.close()},5e3),o.onclick=()=>{window.focus(),o.close()}}}updateOrder(t){this.mockDataService.updateOrderStatus(t.id,t.status),this.orderUpdateSubject.next(t)}requestNotificationPermissionManually(){return this.requestNotificationPermission().then(()=>this.notificationPermission)}getNotificationPermission(){return this.notificationPermission}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}triggerTestOrder(){this.simulateNewOrder()}triggerTestNotification(){this.simulateNewNotification()}static \u0275fac=function(e){return new(e||n)(u(f))};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})};export{m as a};
